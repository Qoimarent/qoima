<style>
  /* Стили для мобильного вида */
  .qoima-container {
    max-width: 600px; /* Ограничиваем ширину для мобильного стиля */
    margin: 0 auto;
    padding: 10px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  .warehouse-card {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
    padding: 15px;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 10px;
  }
  .card-header h3 {
    margin: 0;
    font-size: 18px;
    color: #333;
  }
  .card-price {
    font-size: 20px;
    font-weight: 700;
    color: #4CAF50; /* Зеленый цвет для цены */
  }
  .card-param {
    font-size: 14px;
    color: #666;
    margin-bottom: 5px;
  }
  .card-param strong {
    color: #333;
    font-weight: 500;
  }
  .card-description {
    font-size: 14px;
    line-height: 1.4;
    color: #444;
    margin-top: 10px;
  }
</style>

<div id="warehouse-list" class="qoima-container">
  <p style="text-align: center; color: #999;">Загрузка объявлений...</p>
</div>

<script>
  // 1. Укажите вашу публичную CSV-ссылку из Google Sheets
  const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSueu3J80IWznT9XLcw7rFEhAnpzUeLXuGkT8Qcg54qyloY73DQ6xy6gXb0rmDVqnHi16zuJoAJaKOr/pub?gid=0&single=true&output=csv';

  // 2. Функция для загрузки и обработки CSV
  async function loadDataAndRender() {
    const container = document.getElementById('warehouse-list');
    container.innerHTML = '<p style="text-align: center; color: #999;">Загрузка...</p>';

    try {
      const response = await fetch(CSV_URL);
      const csvText = await response.text();

      // Простая функция для парсинга CSV (первая строка - заголовки)
      const data = parseCSV(csvText);

      if (data.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666;">Объявления не найдены.</p>';
        return;
      }

      container.innerHTML = ''; // Очищаем "Загрузка..."
      
      // >>>>>> НОВОЕ ИЗМЕНЕНИЕ: Переворачиваем массив, чтобы новые были первыми <<<<<<
      data.reverse(); 

      data.forEach(warehouse => {
        // Создаем HTML-карточку для каждого склада
        const cardHtml = `
          <div class="warehouse-card">
            <div class="card-header">
              <h3>${warehouse.city} / ${warehouse.district}</h3>
              <div class="card-price">${warehouse.price || 'Цена не указана'}</div>
            </div>
            
            <div class="card-param"><strong>Площадь:</strong> ${warehouse.size || 'н/д'}</div>
            <div class="card-param"><strong>Температура:</strong> ${warehouse.temperature || 'Не указана'}</div>
            
            ${warehouse.description ? `<div class="card-description">${warehouse.description}</div>` : ''}

            <div class="card-param" style="margin-top: 15px;">
              <small>Контакт: ${warehouse.contact || 'Скрыт'}</small>
            </div>
          </div>
        `;
        container.innerHTML += cardHtml;
      });

    } catch (error) {
      console.error('Ошибка загрузки данных:', error);
      container.innerHTML = '<p style="text-align: center; color: red;">Ошибка загрузки объявлений. Попробуйте позже.</p>';
    }
  }

  // Очень простой парсер CSV
  function parseCSV(csv) {
    const lines = csv.trim().split('\n');
    if (lines.length < 2) return [];

    // Извлекаем заголовки (первая строка)
    const headers = lines[0].split(',').map(h => h.trim().toLowerCase());

    // Пропускаем первую строку (заголовки) и обрабатываем данные
    const data = lines.slice(1).map(line => {
      const values = line.split(',').map(v => v.trim());
      const item = {};
      
      headers.forEach((header, i) => {
        // Здесь мы используем названия столбцов из вашего промпта: city, district, size, price и т.д.
        item[header] = values[i]; 
      });
      return item;
    });
    return data;
  }

  // Запускаем загрузку при загрузке страницы
  loadDataAndRender();
</script>
